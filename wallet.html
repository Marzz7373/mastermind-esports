<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mastermind Esports Wallet</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(180deg, #000000, #1a1a1a);
      color: #f0c040;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    .box {
      background: #111;
      border: 2px solid #f0c040;
      border-radius: 12px;
      padding: 25px;
      margin-top: 50px;
      width: 330px;
      display: inline-block;
      box-shadow: 0 0 15px rgba(240,192,64,0.3);
    }
    input {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #f0c040;
      background: #000;
      color: #f0c040;
      text-align: center;
      font-size: 15px;
    }
    button {
      background: #f0c040;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      color: #000;
      margin: 5px;
    }
    button:hover {
      background: #ffdb70;
    }
    hr {
      border: 0;
      border-top: 1px solid #f0c040;
      margin: 15px 0;
    }
  </style>
</head>
<body>
  <div class="box">
    <h2>ðŸ’³ Mastermind Esports Wallet</h2>
    <input id="phone" placeholder="Enter phone number" />
    <button onclick="getBalance()">Check Balance</button>
    <div id="result"></div>
    <hr>
    <div id="adminPanel" style="display:none;">
      <h3>Admin Panel</h3>
      <input id="amount" placeholder="Amount (e.g. +50 or -10)">
      <input id="adminKey" type="password" placeholder="Admin Key">
      <button onclick="updateBalance()">Update</button>
    </div>
  </div>

  <script>
    const api = "https://script.google.com/macros/s/AKfycbwThsY4CW-Zt9I430Acq23USL6CgUeozXYIpkt1CCSICtAZd_U9chN8zD9pUfGtLpbk/exec";

    async function getBalance() {
      const phone = document.getElementById('phone').value.trim();
      const resultDiv = document.getElementById('result');
      if (!phone) {
        resultDiv.innerHTML = "<p style='color:red;'>Please enter your phone number.</p>";
        return;
      }
      resultDiv.innerHTML = "Checking...";
      const res = await fetch(api, {
        method: "POST",
        body: JSON.stringify({ action: "getBalance", phone })
      });
      const data = await res.json();
      if (data.success) {
        resultDiv.innerHTML = `
          <h3>${data.name}</h3>
          <p>Balance: <b>RM${data.balance}</b></p>
          <p><b>History:</b><br><small>${(data.history || '-').replace(/\n/g, '<br>')}</small></p>
        `;
        document.getElementById("adminPanel").style.display = "block";
      } else {
        resultDiv.innerHTML = `<p style='color:red;'>${data.message}</p>`;
      }
    }

    async function updateBalance() {
      const phone = document.getElementById('phone').value.trim();
      const amount = parseFloat(document.getElementById('amount').value);
      const adminKey = document.getElementById('adminKey').value.trim();
      const resultDiv = document.getElementById('result');
      if (!phone || isNaN(amount) || !adminKey) {
        alert("Please fill all fields correctly!");
        return;
      }
      resultDiv.innerHTML = "Processing...";
      const res = await fetch(api, {
        method: "POST",
        body: JSON.stringify({ action: "updateBalance", phone, amount, adminKey })
      });
      const data = await res.json();
      if (data.success) {
        resultDiv.innerHTML = `<p>âœ… Updated! New Balance: RM${data.newBalance}</p>`;
      } else {
        resultDiv.innerHTML = `<p style='color:red;'>${data.message}</p>`;
      }
    }
  </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mastermind Esports Wallet</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(180deg, #000000, #1a1a1a);
      color: #f0c040;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    .box {
      background: #111;
      border: 2px solid #f0c040;
      border-radius: 12px;
      padding: 25px;
      margin-top: 50px;
      width: 330px;
      display: inline-block;
      box-shadow: 0 0 15px rgba(240,192,64,0.3);
    }
    input {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #f0c040;
      background: #000;
      color: #f0c040;
      text-align: center;
      font-size: 15px;
    }
    button {
      background: #f0c040;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      color: #000;
      margin: 5px;
    }
    button:hover {
      background: #ffdb70;
    }
    hr {
      border: 0;
      border-top: 1px solid #f0c040;
      margin: 15px 0;
    }
  </style>
</head>
<body>
  <div class="box">
    <h2>ðŸ’³ Mastermind Esports Wallet</h2>
    <input id="phone" placeholder="Enter phone number" />
    <button onclick="getBalance()">Check Balance</button>
    <div id="result"></div>
    <hr>
    <div id="adminPanel" style="display:none;">
      <h3>Admin Panel</h3>
      <input id="amount" placeholder="Amount (e.g. +50 or -10)">
      <input id="adminKey" type="password" placeholder="Admin Key">
      <button onclick="updateBalance()">Update</button>
    </div>
  </div>

  <script>
    const api = "https://script.google.com/macros/s/AKfycbwThsY4CW-Zt9I430Acq23USL6CgUeozXYIpkt1CCSICtAZd_U9chN8zD9pUfGtLpbk/exec";

    async function getBalance() {
      const phone = document.getElementById('phone').value.trim();
      const resultDiv = document.getElementById('result');
      if (!phone) {
        resultDiv.innerHTML = "<p style='color:red;'>Please enter your phone number.</p>";
        return;
      }
      resultDiv.innerHTML = "Checking...";
      const res = await fetch(api, {
        method: "POST",
        body: JSON.stringify({ action: "getBalance", phone })
      });
      const data = await res.json();
      if (data.success) {
        resultDiv.innerHTML = `
          <h3>${data.name}</h3>
          <p>Balance: <b>RM${data.balance}</b></p>
          <p><b>History:</b><br><small>${(data.history || '-').replace(/\n/g, '<br>')}</small></p>
        `;
        document.getElementById("adminPanel").style.display = "block";
      } else {
        resultDiv.innerHTML = `<p style='color:red;'>${data.message}</p>`;
      }
    }

    async function updateBalance() {
      const phone = document.getElementById('phone').value.trim();
      const amount = parseFloat(document.getElementById('amount').value);
      const adminKey = document.getElementById('adminKey').value.trim();
      const resultDiv = document.getElementById('result');
      if (!phone || isNaN(amount) || !adminKey) {
        alert("Please fill all fields correctly!");
        return;
      }
      resultDiv.innerHTML = "Processing...";
      const res = await fetch(api, {
        method: "POST",
        body: JSON.stringify({ action: "updateBalance", phone, amount, adminKey })
      });
      const data = await res.json();
      if (data.success) {
        resultDiv.innerHTML = `<p>âœ… Updated! New Balance: RM${data.newBalance}</p>`;
      } else {
        resultDiv.innerHTML = `<p style='color:red;'>${data.message}</p>`;
      }
    }
  </script>
</body>
</html>// Mastermind Esports Wallet API (v2)
const SHEET_ID = "1MiFVoPbtIiP45nk4pbVeFKyyJ0QgMj8pBodD1rrd2ew";
const SHEET_NAME = "Sheet1";

function doGet(e) {
  return HtmlService.createHtmlOutput("Wallet API v2 Running âœ…");
}

function doPost(e) {
  try {
    const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName(SHEET_NAME);
    const data = JSON.parse(e.postData.contents);
    const action = data.action;

    if (action === "getBalance") {
      const phone = data.phone;
      const rows = sheet.getDataRange().getValues();
      for (let i = 1; i < rows.length; i++) {
        if (rows[i][0] == phone) {
          return send({
            success: true,
            name: rows[i][1],
            balance: rows[i][2],
            history: rows[i][3]
          });
        }
      }
      return send({ success: false, message: "Phone not found" });
    }

    if (action === "updateBalance") {
      const { phone, amount, adminKey } = data;
      if (adminKey !== "MASTER2025") return send({ success: false, message: "Unauthorized" });

      const rows = sheet.getDataRange().getValues();
      for (let i = 1; i < rows.length; i++) {
        if (rows[i][0] == phone) {
          const newBalance = Number(rows[i][2]) + Number(amount);
          const sign = amount > 0 ? "+" : "";
          const historyEntry = `${new Date().toLocaleString()} : ${sign}${amount}`;
          sheet.getRange(i + 1, 3).setValue(newBalance);
          sheet.getRange(i + 1, 4).setValue(`${rows[i][3] || ""}\n${historyEntry}`);
          sheet.getRange(i + 1, 5).setValue(new Date());
          return send({ success: true, newBalance });
        }
      }
      return send({ success: false, message: "Phone not found" });
    }

  } catch (err) {
    return send({ success: false, error: err.toString() });
  }
}

function send(obj) {
  return ContentService.createTextOutput(JSON.stringify(obj))
    .setMimeType(ContentService.MimeType.JSON);
}
